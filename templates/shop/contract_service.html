{% extends 'shop/base_shop.html' %}
{% load static %}

{% block all_products %}
    <div class="col-12 mb-5">
        <h5 class="btn footer-ligth__blue font-weight-bold text-white">Servicios</h5>
    </div>
{% endblock %}

{% block content %}
<div class="w-100 d-flex align-items-center justify-content-center">
    <div class="card d-flex flex-column align-items-center justify-content-center p-5" style="width: 35%;">
        <h2 class="mb-3">{{ service }}</h2>
        <img class="big-logo" src="{% static 'img/logos/Cat.png' %}" alt="">
        <br>
        <p><b>Servicio: </b> {{ service }}</p>
        <p><b>Precio: </b>${{ service.price }}</p>
        <br>
        <em>*Una vez contratado el servicio se a domicilio se tomará tu ubicación actual</em>
        <br>
        <input type="number" name="" id="service_id" value={{ service.id }} hidden>
        
        <button class="btn btn-primary" id="comp"><i class="fas fa-shopping-cart mr-1"></i>Contratar</button>
        <a href="{% url 'services' %}"><button class="btn btn-danger mt-2"><i class="fas fa-times mr-1"></i>Cancelar</button></a>
    </div>
</div>


<script>

    /*
        // Función para obtener el usurio del local storage
        */
    var getUser = function () {
        let res = JSON.parse(localStorage.getItem('user'));
        return res
    }
    /*
    // Función para incrementar la cantidad de producto
    */
    document.getElementById('comp').addEventListener("click", function () {
        swal({
                        title: "Vas a contratar el siguiente servicio, ¿estás de acuerdo?",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    })
                    .then((willDelete) => {
                    if (willDelete) {
                        

                        let user = getUser();
                        let service_id = document.getElementById('service_id').value;
                        var xhttp = new XMLHttpRequest();
                        xhttp.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                data = JSON.parse(this.responseText)
                                console.log(data);
                                if(data.success){
                                    swal("¡Compra realizada!", "Estamos preparando todo, nos comunicaremos contigo", "success");
                                }else{
                                    swal("No estamos disponibles por el momento, intenta después", " ", "error");
                                }
                            }
                        };
                xhttp.open("POST", "{% url 'buy_service' %}", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(`user_id=${user.id}&service_id=${service_id}`);
    
                }
            });
        });
</script>

{% endblock %}